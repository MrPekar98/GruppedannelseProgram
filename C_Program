#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>
#include <string.h>
#define GROUP_MAX_SIZE 6

/* Enumerations */
enum type_t {visionary = 1, idealist, conductor, troubleshooter};
typedef enum type_t personType_t;

/* Structs */
/* Belbin struct */
struct belbinTestData
{
    int plant;
    int monitorEvaluator;
    int specialist;
    int shaper;
    int implementer;
    int completerFinisher;
    int coordinator;
    int teamworker;
    int resourceInvestigator;
};

/* Structs */
/* Main struct: person struct */
struct person
{
    char name[30];
    personType_t type;

    /* Belbin struct declaration */
    struct belbinTestData belbin;
};
typedef struct person personData;

/* Group struct */
struct group
{
    /* Array of members */
    personData members[GROUP_MAX_SIZE];

    /* Average values */
    int averagePlant;
    int averageMonitorEvaluator;
    int averageSpecialist;
    int averageShaper;
    int averageImplementer;
    int averageCompleterFinisher;
    int averageCoordinator;
    int averageTeamworker;
    int averageResourceInvestigator;
};
typedef struct group group;

struct matrix
{
    int value;
    char mark;
};
typedef struct matrix matrix;

/* Protocols */
void personDataAssignment(personData *DataArray, int arraySize);
void createGroups(group *groups, int amountOfGroups);
void averageBelbinValues(group *belbinGroup, int groupSize);
int plantAverageValue(group *belbinGroup, int groupSize);
int monitorEvaluatorAverageValue(group belbinGroup, int groupSize);

int groupsSize(personData *groupMembers);

/* Main function */
int main()
{
    printf("Saved textfile must be located in the same directory as this program.\n\n");

    int amountOfStudents;

    printf("Amount of students: ");
    int test = scanf("%d", &amountOfStudents);

    if (test != 1)        /* Format exception. */
    {
        printf("\nFormat exception.\n");
        exit(1);
    }

    /* Data array: Containing all information about every student. */
    personData *persons = (personData *) malloc(amountOfStudents * sizeof(personData));

    if (persons == NULL)        /* Not enough memory. */
    {
        printf("\nNot enough space on memory.\n");
        exit(1);
    }

    personDataAssignment(persons, amountOfStudents);

    /* Array of groups. */
    group groups[amountOfStudents / GROUP_MAX_SIZE];

    return 0;
}

/* Assigning data to main array containing all student. */
void personDataAssignment(personData *DataArray, int arraySize)
{
    FILE *textfile = fopen("TestResultater.txt", "r");

    if (textfile == NULL)       /* If textfile doesn't exist. */
    {
        printf("\nFile does not eixts.\n");
        exit(1);
    }

    int i;
    for (i = 0; i < arraySize; i++)
    {
        fscanf(textfile, "%s %d %d %d %d %d %d %d %d %d %d", DataArray[i].name, &DataArray[i].type, &DataArray[i].belbin.plant, &DataArray[i].belbin.monitorEvaluator, &DataArray[i].belbin.specialist, &DataArray[i].belbin.shaper, &DataArray[i].belbin.implementer, &DataArray[i].belbin.completerFinisher, &DataArray[i].belbin.coordinator, &DataArray[i].belbin.teamworker, &DataArray[i].belbin.resourceInvestigator);
    }

    fclose(textfile);
}

/* Main function for creating groups. */
void createGroups(group *groups, int amountOfGroups)
{
    /* Matrix */
    matrix matrixArray[amountOfGroups][amountOfGroups];
}

/* Average Belbin values for a group. */
void averageBelbinValues(group *belbinGroup, int groupSize)
{
    (*belbinGroup).averagePlant = plantAverageValue(*belbinGroup, groupSize);
    (*belbinGroup).averageMonitorEvaluator = monitorEvaluatorAverageValue(*belbinGroup, groupSize);
}

/* Average group value for plant. */
int plantAverageValue(group belbinGroup, int groupSize)
{
    int i, sum = 0;
    for (i = 0; i < groupSize; i++)
    {
        sum += belbinGroup.members[i].belbin.plant;
    }

    return sum / groupSize;
}

/* Average group value for monitor evaluator. */
int monitorEvaluatorAverageValue(group belbinGroup, int groupSize)
{
    int i, sum = 0;
    for (i = 0; i < groupSize; i++)
    {
        sum += belbinGroup.members[i].belbin.monitorEvaluator;
    }

    return sum / groupSize;
}

/* Returns size of a group. */
int groupsSize(personData *groupMembers)
{
    int i = 0;
    while (groupMembers[i].type == 1 || groupMembers[i].type == 2 || groupMembers[i].type == 3 || groupMembers[i].type == 4)
    {
        i++;
    }

    return i;
}
